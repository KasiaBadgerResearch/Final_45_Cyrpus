# How have communications and computer services evolved relative to each other as shares of service exports and service imports in Cyprus between 1976 and 2024?

import pandas as pd
import matplotlib.pyplot as plt
import os

# Folders
data_raw_folder = "data_raw/"
data_clean_folder = "data_clean/"
figures_folder = "figures/"

# Load CSV
filename = "economy-and-growth_cyp_filtered.csv"  # Filtered dataset with only relevant rows
df = pd.read_csv(os.path.join(data_raw_folder, filename))

# Keep only needed columns
df = df[["Year", "Indicator Name", "Value"]]

# Convert Year and Value to numeric, drop invalid rows
df["Year"] = pd.to_numeric(df["Year"], errors="coerce")
df["Value"] = pd.to_numeric(df["Value"], errors="coerce")
df = df.dropna(subset=["Year", "Value"])

# Pivot indicators into separate columns
df_pivot = df.pivot(index="Year", columns="Indicator Name", values="Value").reset_index()
df_pivot = df_pivot.sort_values("Year")

print("Pivoted Cyrpus dataset:")
display(df_pivot)

# Interpolate missing values for smooth plotting (optional)
df_plot = df_pivot.interpolate(method='linear')

# Plot the indicators
plt.figure(figsize=(10,6))
plt.plot(df_plot["Year"], df_plot["Communications, computer, etc. (% of service imports, BoP)"], 
         marker='o', linestyle='-', label="Communications, computer, etc. (% of service imports, BoP)")
plt.plot(df_plot["Year"], df_plot["Communications, computer, etc. (% of service exports, BoP)"], 
         marker='o', linestyle='-', label="Communications, computer, etc. (% of service exports, BoP)")

plt.title("Cyprus: Imports vs Exports of communications, computer, etc. (%) (1976-2024)")
plt.xlabel("Year")
plt.ylabel("Percentage")
plt.legend()
plt.grid(True)
plt.tight_layout()
plt.savefig(os.path.join(figures_folder, "cyprus_imports_vs_exports_of_communications_computer_etc.png"))
plt.show()

# Save cleaned CSV
df_pivot.to_csv(os.path.join(data_clean_folder, "cyprus_imports_vs_exports_of_communications_computer_etc"), index=False)
